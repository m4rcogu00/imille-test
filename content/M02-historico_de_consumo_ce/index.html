+++
title = "Historico de Consumo CE"
layout = "moduli_private_area_brasil"
+++

<div class="pvtArea-main pvtArea-column pvtArea-historico-consumo">
    <div class="pvtArea-breadcrumb desktop-visible">
        <span>INÍCIO / SEGUNDA VIA</span>
    </div>

    <div class="pvtArea-account mobile-white">
        <div class="pvtArea-account-row pvtArea-account-row-faturamento">
            <div class="pvtArea-account-table-row threeItems">
                <div class="pvtArea-account-table-item">
                    <span class="pvtArea-account-item-title">Títular da conta</span>
                    <span class="text">Marta Nunes</span>
                </div>
                <div class="pvtArea-account-table-item">
                    <span class="pvtArea-account-item-title">Nº da Instalação</span>
                    <span class="text">3854491796</span>
                </div>
                <div class="pvtArea-account-table-item">
                    <span class="pvtArea-account-item-title">Endereço de instalação</span>
                    <span class="text"> Rua Domingos Sávio, 123, Pedra, Eusébio, CE
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="pvtArea-account">
        
        <div class="pvtArea-info-box hidden-xs">
            <h2>
                Histórico de Consumo
            </h2>
            
            <div class="pvtArea-info-box-icon-box hidden-xs">
                <div>
                    <img src="../img/icons/icon-bulb.svg" />
                </div>
                <p>
                    Tenha acesso rápido e fácil as faturas de códigos de barras da sua Unidade Consumidora.
                </p>
            </div>
            
            <p class="pvtArea-account-item-text hidden-xs">
                Para realizar o download, clique no ícone PDF para impressão; ou copie os códigos de barra para efetuar 
                os pagamentos online:
            </p>
        </div>

        <div class="visible-xs">
            
            <h2 class="pvtArea-account-item-title" style="margin-top: 22px;">
                Histórico de Consumo
            </h2>

            <h3 class="pvtArea-select-heading">
                Escolha o Mês de Referência que deseja consultar:
            </h3>
            <select class="form-control selectbox-gray " id="listaMeses" name="listaMeses">
                <option value="06/2019" >Junio - 2019</option>
                <option value="07/2019">Julio - 2019</option>
                <option value="10/2019" selected>Setembro - 2019</option>
                <option value="11/2019">Novembre - 2019</option>
                <option value="08/2018">Agosto - 2018</option>
            </select>
        </div>

        <div id="mobileTableGraphic" class="mobile-table-chart-scroll-wrapper"></div>
        
        <div class="table-scroll-wrapper pvtArea-table-scroll">
            <table class="table-pvt mobile-heading-on-side  display table-has-chart" id="tablaHistoricoConsumo">
                <thead>
                <tr>
                    <th scope="col" width="12%">N°</th>
                    <th scope="col" width="6%">Data de Leitura</th>
                    <th scope="col" width="12%">Leitura</th>
                    <th scope="col" width="18%">Referência</th>
                    <th scope="col" width="12%">Consumo (Kwh)</th>
                    <th scope="col" width="15%">Vencimiento</th>
                    <th scope="col" width="6%">Tipo</th>
                    <th scope="col" width="6%">Valor</th>
                    <th scope="col" width="12%">Pagamento</th>
                </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-label="N°" class="details-control"><span></span> 47 </td>
                        <td data-label="Data de Leitura">26/11/2019</td>
                        <td data-label="Leitura">11/2019</td>
                        <td data-label="Referência"> 11/2019</td>
                        <td data-label="Consumo (Kwh)">164</td>
                        <td data-label="Vencimiento">05/11/2019</td>
                        <td data-label="Tipo">Fatura</td>
                        <td data-label="Valor">R$ 99,99</td>
                        <td data-label="Pagamento">Em aberto</td>
                    </tr>
                    <tr>
                        <td data-label="N°" class="details-control"><span></span> 46 </td>
                        <td data-label="Data de Leitura" >26/10/2019</td>
                        <td data-label="Leitura">10/2019</td>
                        <td data-label="Referência"> 10/2019</td>
                        <td data-label="Consumo (Kwh)">2391</td>
                        <td data-label="Vencimiento">05/11/2019</td>
                        <td data-label="Tipo">Fatura</td>
                        <td data-label="Valor">R$ 99,99</td>
                        <td data-label="Pagamento">Em aberto</td>
                    </tr>
                    <tr>
                        <td data-label="N°" class="details-control"><span></span> 45 </td>
                        <td data-label="Data de Leitura">26/09/2019</td>
                        <td data-label="Leitura">09/2019</td>
                        <td data-label="Referência"> 09/2019</td>
                        <td data-label="Consumo (Kwh)">164</td>
                        <td data-label="Vencimiento">05/09/2019</td>
                        <td data-label="Tipo">Fatura</td>
                        <td data-label="Valor">R$ 99,99</td>
                        <td data-label="Pagamento">Em aberto</td>
                    </tr>
                    <tr>
                        <td data-label="N°" class="details-control"><span></span> 44 </td>
                        <td data-label="Data de Leitura">26/08/2019</td>
                        <td data-label="Leitura">08/2019</td>
                        <td data-label="Referência"> 08/2019</td>
                        <td data-label="Consumo (Kwh)">164</td>
                        <td data-label="Vencimiento">05/09/2019</td>
                        <td data-label="Tipo">Fatura</td>
                        <td data-label="Valor">R$ 99,99</td>
                        <td data-label="Pagamento">Em aberto</td>
                    </tr>
                    <tr>
                        <td data-label="N°" class="details-control"><span></span> 43 </td>
                        <td data-label="Data de Leitura">26/07/2019</td>
                        <td data-label="Leitura">07/2019</td>
                        <td data-label="Referência"> 07/2019</td>
                        <td data-label="Consumo (Kwh)">164</td>
                        <td data-label="Vencimiento">05/08/2019</td>
                        <td data-label="Tipo">Fatura</td>
                        <td data-label="Valor">R$ 99,99</td>
                        <td data-label="Pagamento">Paga (21/07/2019)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div style="margin-top:48px">
            <button class="latam-btn-cta--lightgrey">
                <span class="icon-debito_automatico"></span> <span>Segunda Via</span>
            </button>
        </div>
    </div>
</div>

<script>

$(function(){
    
    function format(d){
        return '<div class="row-chart">'+
                    '<h4>'+
                        'Média de Consumo dos últimos 12 meses: <span> '+d[4]+' Kwh </span>'+
                    '</h4>'+
                    '<div class="table-chart-scroll-wrapper">'+
                        '<div class="chart-container">'+
                            '<canvas id="graph-'+d[0]+'" class="chart"></canvas>'+
                        '</div>'+
                    '</div>'+
                '</div>';
    }

    $('#tablaHistoricoConsumo tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = tablaHistoricoConsumo.row( tr );
 
        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {

            var data = row.data();
            // Open this row

            row.child( format(data)).show();
            tr.addClass('shown');

            initGraph( data );
        }
    } );


    function initGraph(data){

        var ctx = document.getElementById("graph-"+data[0]).getContext('2d');
    
        var data = {
            labels: ["01/2019", "02/2019", "03/2019", "04/2019", "05/2019", "06/2019", "07/2019", "08/2019", "09/2019", "10/2019", "11/2019", "12/2019"],
            datasets: [{
                data: [130, 145, 132, 134, 305, 117, 115, 148, 138, 142, 180, 280],
                backgroundColor: '#6fabd2',
                hoverBackgroundColor: '#6fabd2',
                borderWidth: 0,
                fill: true
            }]
        };
        
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: data,
            options: options
        });
    }

    var options = {
        events: [],
        responsive: true,
        maintainAspectRatio: false,
        layout:{
            padding:{
                top: 20,
                bottom: 80,
                left: 100
            }
        },
        legend: {
            display: false,
            labels: {
                boxWidth: 12
            }
        },
        scales: {
            yAxes: [{
                ticks: {
                    display: false
                },
                scaleLabel: {
                    display: false
                },
                gridLines: {
                    display:false,
                    drawBorder:false,
                }
            }],
            xAxes: [{
                scaleLabel: {
                    display: false
                },
                categoryPercentage: 0.7,
                barPercentage: 0.7,
                gridLines: {
                    display:false
                },
                ticks:{
                    display:false,
                    maxRotation: 0,
                    minRotation: 0,
                    fontFamily: 'Univers',
                    fontSize: '13',
                    fontColor: "#000"
                },
            }],
        },
        tooltips: {
            enabled: false
        },
        animation: {
            duration: 100,
            onComplete: function () {
                var chartInstance = this.chart;
                var ctx = chartInstance.ctx;
                var labels = this.data.labels;
                var height = chartInstance.controller.boxes[0].bottom;
                var width = chartInstance.controller.boxes[0].width + 100;
                
                ctx.fillStyle = '#d7d7d6';
                
                ctx.fillRect(0, (chartInstance.controller.height - 74), width, 19);
                
                ctx.fillRect(0, (chartInstance.controller.height - 25), width, 19);
                
                
                ctx.fillStyle = "#000";
                ctx.font = "bold 10pt UniversBold"
                
                ctx.fillText( 'Consumo', 10, (chartInstance.controller.height / 2) - 20 );
                ctx.fillText( 'Referência', 10, (chartInstance.controller.height - 60));
                ctx.fillText( 'Tipo', 10,  (chartInstance.controller.height - 36));
                ctx.fillText( 'Bandeira', 10, (chartInstance.controller.height - 11));
                
                ctx.textAlign = "center";

                Chart.helpers.each(this.data.datasets.forEach(function (dataset, i) {
                    var meta = chartInstance.controller.getDatasetMeta(i);

                    Chart.helpers.each(meta.data.forEach(function (bar, index) {

                        ctx.fillStyle = "#bf175e";
                        ctx.font = "bold 10pt UniversBold"


                        ctx.fillText(dataset.data[index] + ' Kwh', bar._model.x, height - (height - bar._model.y + 10));
                        
                        ctx.fillStyle = "#000";
                        ctx.font = "10pt Univers";

                        ctx.fillText( labels[index], bar._model.x, (chartInstance.controller.height - 60));

                        ctx.fillText( 'Normal', bar._model.x, (chartInstance.controller.height - 36));

                        drawChartFlag(dataset.data[index], ctx, bar._model.x - 4, (chartInstance.controller.height - 25));
                    
                    }),this)
                }),this);
            }
        }
    };

    function drawChartFlag(consumo , ctx, x, y){
        let greenFlag = '../img/privateArea/green-flag.png';
        let redFlag = '../img/privateArea/red-flag.png';
        let yellowFlag = '../img/privateArea/yellow-flag.png';
        var base_image = new Image();

        /*  --Conditions to switch between flag types--  */
        if(consumo >= 300){
            base_image.src = redFlag;
        }else if(consumo >= 200){
            base_image.src = yellowFlag;
        }else{
            base_image.src = greenFlag;
        }
        /*  --Conditions to switch between flag types--  */
        
        base_image.onload = function(){
            ctx.drawImage(base_image, x, y, 18, 18);
        }
    }

    var tablaHistoricoConsumo = $('#tablaHistoricoConsumo').DataTable( {
        "ordering": false,
        "info": false,
        "searching": true,
        "scrollX": false,
        "lengthChange": false,
        "paging": true,
        "language": {
            "paginate": {
                "previous": "Anterior",
                "next": "Próxima"
            },
            "zeroRecords": "Não há registros a serem exibidos"
        }
    });
    
    // Stores the select element in a variable
    var monthSelectBox = $("#listaMeses");

    // Creates the SelectBoxIt drop down
    monthSelectBox.selectBoxIt();

    // Listens for the change event on the original select box
    monthSelectBox.on("change", function() {
        // Prints the updated drop down value
        setMobileTableValue();
    });
    
    if(window.innerWidth < 768){
        setMobileTableValue();
    }


    function setMobileTableValue(){
        $('#mobileTableGraphic').html('');
        var val = monthSelectBox.val();
        var search = tablaHistoricoConsumo.columns(1).search( val )
        search.draw();

        var data = tablaHistoricoConsumo.row( $('#tablaHistoricoConsumo tbody tr')).data(); 

        if(data){
            $('#mobileTableGraphic').html(format(data));
            initGraph( data );
        }
    }
})

</script>
